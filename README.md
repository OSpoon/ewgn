# ewgnã€Šä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äººå®æˆ˜ã€‹

> Dearï¼Œå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯â€œå‰ç«¯å°é‘«åŒå­¦â€ï¼ŒğŸ˜‡é•¿æœŸä»äº‹å‰ç«¯å¼€å‘ï¼Œå®‰å“å¼€å‘ï¼Œçƒ­è¡·æŠ€æœ¯ï¼Œåœ¨ç¼–ç¨‹è·¯ä¸Šè¶Šèµ°è¶Šè¿œï½


---

### èƒŒæ™¯ä»‹ç»
æˆ‘ä»¬å…¬å¸ä¸€ç›´åœ¨ç”¨ä¼ä¸šå¾®ä¿¡æ¥åšå‘˜å·¥çš„æ²Ÿé€šå·¥å…·ï¼Œä¸å°‘ç¾¤é‡Œé¢éƒ½æœ‰æ·»åŠ ä¸€ä¸‹ç¾¤èŠæœºå™¨äººæ¥åšä¸€ä¸‹ä»»åŠ¡çš„æé†’ï¼Œé‚£ä¹ˆåšä¸ºç¾¤èŠæœºå™¨äººçš„ä¸€ä¸ªåº”ç”¨åœºæ™¯è‡ªç„¶å°±æ˜¯æ‰§è¡Œå®šä¹‰ä»»åŠ¡ï¼Œå¦‚å®šæ—¶å‘é€ä¼šè®®æé†’ï¼Œå‘¨æŠ¥å¡«å†™æé†’ç­‰ç­‰ï¼Œé‚£å¾€å¾€æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€å°ä¸å…³æœºçš„ä¸ªäººPCæˆ–è€…äº‘æœåŠ¡å™¨æ¥æ”¯æŒç¾¤èŠæœºå™¨äººçš„é•¿æ—¶é—´è¿è¡Œï¼ˆWindowsç³»ç»Ÿä¸­çš„å¹¿å‘Šå¯ä»¥åœ¨ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­æ‰¾åˆ°å¹¶å…³é—­ï¼‰ï¼Œä¸ªäººè‡ªç”¨çš„PCç”µè„‘å…¶å®ä¸å¤ªé€‚åˆé•¿æ—¶é—´çš„è¿è¡Œï¼ˆWindowsè°ç”¨è°çŸ¥é“ï¼Œæ²¡å¤šä¹…å°±ä¼šå˜å¡ï¼‰ï¼Œäº‘æœåŠ¡å™¨ä¹Ÿéœ€è¦èŠ±è´¹ä¸å°‘çš„è´¹ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ä¸ª**Serverless**çš„å¹³å°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆå…è´¹çš„é¢åº¦ä¹Ÿå¤Ÿç”¨äº†ï¼Œç»å¯¹è¶…å€¼ï¼‰ã€‚
### æ¡ˆä¾‹ä»‹ç»
æˆ‘ä»¬é€šè¿‡é‡‡ç”¨è…¾è®¯äº‘å¹³å°ä¸­**Serverless**äº§å“ä¸‹çš„**äº‘å‡½æ•°**æ¥åšæœåŠ¡æ”¯æ’‘å®Œæˆä¸€ä¸ªä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äººå®šæ—¶æ¯å¤©æ—©8ç‚¹å‘é€å½“å¤©å¤©æ°”æƒ…å†µçš„ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå®ç°æ­¤æ¡ˆä¾‹ä½ éœ€è¦åšå¦‚ä¸‹å‡†å¤‡å·¥ä½œï¼š

1. æ³¨å†Œè…¾è®¯äº‘å¹³å°ï¼š[https://cloud.tencent.com/](https://cloud.tencent.com/)
1. æ³¨å†Œä¼ä¸šå¾®ä¿¡å¹³å°ï¼š[https://work.weixin.qq.com/](https://work.weixin.qq.com/)
1. ä½¿ç”¨VSCodeIDEå¹¶å®‰è£…æ’ä»¶ã€ŠTencent Serverless Toolkit for VS Codeã€‹
### ä¼å¾®ç¾¤æœºå™¨äººå¦‚ä½•å‘é€æ¶ˆæ¯ï¼š
å®ç°ä¼å¾®ç¾¤æœºå™¨äººæ¶ˆæ¯å‘é€ä¸»è¦æ˜¯é€šè¿‡å‘åˆ†é…ç»™æœºå™¨äººçš„Webhookåœ°å€å‘é€è¯·æ±‚æ¥å®Œæˆçš„ï¼Œå¦‚æœä½ æ˜¯ç¾¤ä¸»å½“ä½ æ‹‰æœºå™¨äººè¿›ç¾¤åæŸ¥çœ‹æœºå™¨äººä¿¡æ¯å°±å¯ä»¥å¾—åˆ°æœºå™¨äººå¯¹åº”çš„Webhookåœ°å€äº†ï¼Œç‰¹åˆ«ç‰¹åˆ«è¦æ³¨æ„ï¼šä¸€å®šè¦ä¿æŠ¤å¥½æœºå™¨äººçš„webhookåœ°å€ï¼Œé¿å…æ³„æ¼ï¼ä¸è¦åˆ†äº«åˆ°githubã€åšå®¢ç­‰å¯è¢«å…¬å¼€æŸ¥é˜…çš„åœ°æ–¹ï¼Œå¦åˆ™åäººå°±å¯ä»¥ç”¨ä½ çš„æœºå™¨äººæ¥å‘åƒåœ¾æ¶ˆæ¯äº†ã€‚ã€‚

- ä¼å¾®ç¾¤æœºå™¨äººé…ç½®è¯´æ˜ï¼š[https://work.weixin.qq.com/api/doc/90000/90136/91770](https://work.weixin.qq.com/api/doc/90000/90136/91770)

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640353287394-17076616-7a71-468f-bbc8-965bccea4af2.png#clientId=u732b3123-d254-4&from=paste&id=u1ce3988a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=470&originWidth=383&originalType=binary&ratio=1&size=58948&status=done&style=none&taskId=u4b3ca5e9-8f33-4941-bd95-b7937ebceda)
#### é¡¹ç›®ç¯å¢ƒå‡†å¤‡ï¼š

1. åˆå§‹åŒ–é¡¹ç›®ï¼š`npm init -y`
1. åˆå§‹åŒ–Tsé…ç½®ï¼š`tsc --init`
1. å®‰è£…axiosæ¥å®ç°è¯·æ±‚æ•°æ®ï¼š`yarn add axios`
#### æ¨¡å—åˆ’åˆ†ï¼š

1. model.tsï¼šæ¶ˆæ¯æ¨¡å‹ï¼ˆå¯¹åº”APIæ–‡æ¡£ï¼‰ï¼Œåˆ›å»ºæ¶ˆæ¯æ¨¡å‹å‡½æ•°ï¼›
```typescript
/**
 * æ¶ˆæ¯ç±»å‹
 */
export enum MsgType {
    /** markdownç±»å‹ */
    markdown = "markdown",
}

/**
 * markdowæ¶ˆæ¯æ¨¡å‹
 */
export type MarkdownContext = {
    /** markdownå†…å®¹ï¼Œæœ€é•¿ä¸è¶…è¿‡4096ä¸ªå­—èŠ‚ï¼Œå¿…é¡»æ˜¯utf8ç¼–ç  */
    content: string,
}

/**
 * æ¶ˆæ¯æ¨¡å‹åŸºç±»
 */
export type Message<T> = {
    msgtype: MsgType & T,
    [type: string]: T,
}

/**
 * åˆ›å»ºå¾…å‘é€æ¶ˆæ¯
 * @param type 
 * @param content 
 * @returns 
 */
function createMessage<T>(type: MsgType, content: T) {
    return {
        msgtype: type,
        [type]: content,
    } as Message<T>;
}

/**
 * åˆ›å»ºmarkdownç±»å‹çš„æ¶ˆæ¯
 * @param content 
 * @returns 
 */
export function createFileMessage(content: FileContext) {
    return createMessage<FileContext>(MsgType.file, content);
}
```

2. notice.tsï¼šå‘é€å„ç±»å‹é€šçŸ¥å‡½æ•°ï¼›
```typescript
import axios from 'axios';
import { createFileMessage, createImageMessage, createMarkdownMessage, createNewsMessage, createTextMessage, FileContext, ImageContext, MarkdownContext, Message, NewsContext, TextContext } from './model';

function request<T>(webhook: string, message: Message<T>) {
    if (!webhook) throw new Error("è¯·è®¾ç½®æ­£ç¡®æœºå™¨äººçš„webhookåœ°å€");
    axios.post(webhook, message).then(res => {
        const { status, data } = res;
        if (status === 200 && data) {
            console.log(data.errcode === 0 ? "å‘é€æˆåŠŸ" : data.errmsg);
        }
    }).catch(err => {
        console.log(err);
    })
}

/** å‘èµ·Markdownç±»å‹æ¶ˆæ¯é€šçŸ¥ */
export const requestMDNotice = (webhook: string, mdContext: MarkdownContext) => request<MarkdownContext>(webhook, createMarkdownMessage(mdContext));
```

3. index.tsï¼šå…¥å£æ‰§è¡Œå¤©æ°”ä¿¡æ¯è·å–å’Œè°ƒç”¨å‘é€Markdownç±»å‹æ¶ˆæ¯ã€‚
```typescript
import { requestMDNotice } from "./notice";
import axios from 'axios';
import { AMAP_WEATHER_API, ENTERPRISE_WECHAT_ROBOT_WEB_HOOK } from "./config";
axios.get(AMAP_WEATHER_API).then(res => {
    const { status, data } = res;
    if (status === 200 && data) {
        if (data.status === '1' && data.infocode === '10000') {
            let message = ''
            data.lives.forEach((live: any) => {
                message += `
##### ä»Šå¤©${live.province}ï¼Œ${live.city}å¤©æ°”æƒ…å†µ
* å¤©æ°”ï¼š ${live.weather}
* æ°”æ¸©ï¼š ${live.temperature} æ‘„æ°åº¦
* é£å‘ï¼š ${live.winddirection}
* é£åŠ›ï¼š ${live.windpower} çº§
* æ¹¿åº¦ï¼š ${live.humidity}
* æ•°æ®å‘å¸ƒçš„æ—¶é—´ï¼š ${live.reporttime}\n
                `
            });
            // å‘ä¼ä¸šå¾®ä¿¡ç¾¤å‘é€MDæ ¼å¼çš„é€šçŸ¥
            requestMDNotice(ENTERPRISE_WECHAT_ROBOT_WEB_HOOK, {
                content: message
            })
        }
    }
})
```

4. é«˜å¾·å¤©æ°”æŸ¥è¯¢APIå’Œæœºå™¨äººWebhookåœ°å€é…ç½®ï¼š
```typescript
// ä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äººwebhookåœ°å€
export const  ENTERPRISE_WECHAT_ROBOT_WEB_HOOK = "ã€Šè¯·å¡«å†™ä½ è‡ªå·±æœºå™¨äººçš„webhookåœ°å€ã€‹";
// é«˜å¾·å¤©æ°”æŸ¥è¯¢API,åŸå¸‚åœ°å€åœ¨é«˜å¾·å¼€å‘æ–‡æ¡£æŸ¥è¯¢
export const  AMAP_WEATHER_API = "ã€Šè¯·å¡«å†™ä½ è‡ªå·±ç”³è¯·å¤©æ°”æŸ¥è¯¢åœ°å€ã€‹"
```
#### è¿è¡Œè°ƒè¯•ï¼š

- é€šè¿‡ts-nodeç›´æ¥æ‰§è¡Œæˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ï¼š`ts-node .\src\index.ts`ï¼Œè¾“å‡ºå‘é€æˆåŠŸåå°±å¯ä»¥åœ¨ä¼å¾®ç¾¤çœ‹åˆ°æœ€æ–°çš„æ¶ˆæ¯äº†ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640354130557-c3ccb73b-ef7c-4be1-81c6-2a890a40b7e6.png#clientId=u732b3123-d254-4&from=paste&height=288&id=u1171dff1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1154&originWidth=1125&originalType=binary&ratio=1&size=246749&status=done&style=none&taskId=u325dc52f-deae-42cd-9c2b-546998fa248&width=281)
### äº‘å‡½æ•°æ‰§è¡Œå®šæ—¶å‘é€å¤©æ°”æƒ…å†µä»»åŠ¡ï¼š
#### å®‰è£…å¹¶è®¤è¯†è…¾è®¯äº‘å‡½æ•°å¼€å‘æ’ä»¶ã€ŠTencent Serverless Toolkit for VS Codeã€‹ï¼š

- æ‹‰å–äº‘ç«¯çš„äº‘å‡½æ•°åˆ—è¡¨ï¼Œå¹¶è§¦å‘äº‘å‡½æ•°ã€‚â€‹
- åœ¨æœ¬åœ°å¿«é€Ÿåˆ›å»ºäº‘å‡½æ•°é¡¹ç›®ã€‚
- ä½¿ç”¨æ¨¡æ‹Ÿçš„ COSã€CMQã€CKafkaã€API ç½‘å…³ç­‰è§¦å‘å™¨äº‹ä»¶æ¥è§¦å‘å‡½æ•°è¿è¡Œã€‚
- ä¸Šä¼ å‡½æ•°ä»£ç åˆ°äº‘ç«¯ï¼Œæ›´æ–°å‡½æ•°é…ç½®ã€‚
- åœ¨äº‘ç«¯è¿è¡Œã€è°ƒè¯•å‡½æ•°ä»£ç ã€‚
#### åˆå§‹åŒ–å¹¶ç¼–å†™äº‘å‡½æ•°ï¼š

1. é€šè¿‡VSCodeæ‰“å¼€ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ï¼›
1. è®¤å‡†è…¾è®¯äº‘Logo![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640354355560-1b5ac413-5ee5-4a32-8bf7-aeafc93c6fd6.png#clientId=u732b3123-d254-4&from=paste&height=34&id=u241bd680&margin=%5Bobject%20Object%5D&name=image.png&originHeight=34&originWidth=44&originalType=binary&ratio=1&size=772&status=done&style=none&taskId=u60db04c7-d07d-42fa-bc3f-e630f2c5e07&width=44)æ‰“å¼€æ’ä»¶ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦ç»‘å®šç”¨æˆ·å‡­è¯ï¼Œç»‘å®šåœ°åŸŸï¼›
1. åœ¨æœ¬åœ°å‡½æ•°çª—å£åˆ›å»ºå‡½æ•°=>é€‰æ‹©Nodejsç‰ˆæœ¬=>å¡«å†™å‡½æ•°åï¼Œå¾—åˆ°å¦‚ä¸‹é¡¹ç›®åŸºç¡€æ¨¡æ¿ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640354664506-6301acdb-6881-4f02-b9b8-de7f2f68ea88.png#clientId=u732b3123-d254-4&from=paste&height=166&id=u7f470576&margin=%5Bobject%20Object%5D&name=image.png&originHeight=166&originWidth=216&originalType=binary&ratio=1&size=5948&status=done&style=none&taskId=u32005fca-dcc8-4eca-a786-e0736ac30ef&width=216)

4. å°†æˆ‘ä»¬tsç¼–å†™çš„æœºå™¨äººå‘é€é€šçŸ¥çš„ä»£ç ç¼–è¯‘ä¸ºjsç‰ˆæœ¬ï¼Œç›´æ¥è¿è¡Œ`tsc`åå°†å¾—åˆ°çš„å†…å®¹è¦†ç›–äº‘å‡½æ•°çš„`src`ç›®å½•ï¼ˆindex.jsæ–‡ä»¶éœ€è¦copyå†…å®¹åˆ°main_handlerå‡½æ•°ä¸­ï¼‰ï¼›
4. å› ä¸ºæˆ‘ä»¬æœ‰å®ç”¨`axios`æ¨¡å—æ¥å‘é€è¯·æ±‚ï¼Œæ‰€ä»¥äº‘å‡½æ•°é¡¹ç›®ä¸­ä¹Ÿéœ€è¦å®‰è£…ï¼šè¿›å…¥äº‘å‡½æ•°é¡¹ç›®çš„`**src**`ç›®å½•æ‰§è¡Œï¼š`npm init -y && yarn add axios`ï¼›
#### ä¸Šä¼ å¹¶åœ¨äº‘ç«¯éƒ¨ç½²è°ƒè¯•

- äº‘å‡½æ•°çš„å¼€å‘åˆ°æ­¤å°±å®Œæˆäº†ï¼Œé€šè¿‡æœ¬åœ°å‡½æ•°çª—å£æ‰§è¡Œä¸Šä¼ äº‘å‡½æ•°ï¼ˆnode_moduleå¦‚æœå†…å®¹è¿‡å¤šå»ºè®®å…ˆåœ¨æ§åˆ¶å°è¿›è¡Œå®‰è£…ï¼‰ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰§è¡Œéƒ¨ç½²å’Œæµ‹è¯•ï¼›

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640355408690-277d851b-906b-4380-aba4-7ec246f4bfee.png#clientId=u732b3123-d254-4&from=paste&height=432&id=u3b8bb59b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=575&originWidth=1018&originalType=binary&ratio=1&size=46285&status=done&style=none&taskId=uff4c30b3-87e3-436a-86d6-c3c1d8004c0&width=764)
#### é…ç½®è§¦å‘ç®¡ç†ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

- åœ¨è§¦å‘ç®¡ç†èœå•ä¸­åˆ›å»ºæ–°çš„è§¦å‘å™¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡Cronè¡¨è¾¾å¼é€šè¿‡[https://crontab.guru/every-day](https://crontab.guru/every-day)æŸ¥è¯¢è°ƒæ•´ï¼Œæäº¤åå³å¯å®Œæˆï¼ŒæœŸå¾…æ˜æ—©çš„æ¶ˆæ¯æé†’å§ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640355926812-7e3f760e-ee33-4bfd-83ca-fdf30ec69367.png#clientId=u732b3123-d254-4&from=paste&height=437&id=uWfEP&margin=%5Bobject%20Object%5D&name=image.png&originHeight=437&originWidth=685&originalType=binary&ratio=1&size=30319&status=done&style=none&taskId=u5e6b1864-50fc-4845-988d-61f77a6ca4e&width=685)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2373519/1640355965746-b3ce5f13-c160-476a-b7f5-51201efd7f40.png#clientId=u732b3123-d254-4&from=paste&height=525&id=u19f51a57&margin=%5Bobject%20Object%5D&name=image.png&originHeight=525&originWidth=817&originalType=binary&ratio=1&size=31816&status=done&style=none&taskId=ude35c80e-682e-46cc-a38f-3d3e7644080&width=817)
### ç»“è¯­ï¼š
æœ¬ç¯‡æ¶‰åŠåˆ°çš„å†…å®¹ç‚¹æœ‰ï¼šé«˜å¾·å¼€å‘å¹³å°å¤©æ°”æŸ¥è¯¢APIä½¿ç”¨ï¼Œè…¾è®¯äº‘Serverlessäº‘å‡½æ•°ä½¿ç”¨ï¼Œä¼å¾®ç¾¤æœºå™¨äººé…ç½®åŠAPIï¼Œå…±åŒå®Œæˆäº†ä»Šå¤©çš„å®æˆ˜æ¡ˆä¾‹ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆæœ‰è¶£çš„åº”ç”¨åœºæ™¯å‘¢ï¼Ÿè¯´è¯´çœ‹ï¼ŸğŸ˜‚

---

**æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œå‰ç«¯å°é‘«åŒå­¦â€ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚**
